!Programa para graficar los datos de mareas tomados durante un periodo de tiempo
!para representar el comportamiento de las mareas, segun la hora del dia, 
!temperatura y presion atmosferica
!Código por Ana M. Sotomayor
!¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬|

Module Parametros
     Implicit None
    integer, parameter :: puntos = 7632 !total de puntos
    integer, parameter :: dias = 159 !dias completos muestreados
    integer, parameter :: inicio = 286 !DOY inicial
    integer, parameter :: datos = 48 !Datos por dia
    integer, parameter :: datxmes = 1344
    integer, parameter :: dxmes = 28 !dias por mes lunar
    integer, parameter :: meses = 5 !Meses completos muestreados
    integer, parameter :: semana = 7 !dias de la semana

End Module Parametros

Program Producto7
    Use Parametros
    implicit none
    integer :: i, j, k
    real :: xMax, xMin
    real, dimension (1:meses) :: Minmes, Maxmes,diamax, diamin, periodomax, periodomin
    real, dimension (1:dias) :: Mindia, Maxdia,  horamin, horamax
    real, dimension (1:puntos) :: PresAtm, Temp, NivAgua, DOY
    real, dimension (1:semana) :: Minam,HoraMinam,Maxam, HoraMaxam, Maxpm, HoraMaxpm, Minpm, HoraMinpm
    real, dimension (:,:), Allocatable :: Array,Arraymes
!    real, dimension (:), Allocatable :: Maxdia, xmaxd, Xmind, MinM, MaxM
ALLOCATE (Array(dias,datos))
ALLOCATE (Arraymes(meses,datxmes))

  do i = 1, puntos, 1
     open (1, file = "data.csv", status="old")
    Read (1,*) PresAtm(i), Temp(i), NivAgua(i), DOY(i)
    open (2, file = "HNA.dat")
    open (3, file = "PresionNivelAgua.dat")
    open (4, file = "TempNivelAgua.dat")
    write (2,*) DOY(i), NivAgua(i) 
    Write (3,*) DOY(i), Temp(i) 
    write (4,*) DOY(i), PresAtm(i)
  end do
    close (1)
    close (2)
    close (3)
    close (4) 
!Asignamos valorea a la primera matriz (por dia)

   Open (2, file ="HNA.dat", status = "old")
do i = 1, puntos, 1
   do  j = 1, dias, 1
     do k = 1, datos, 1  
   Read (2,*) DOY(i), NivAgua(i)
      Array (j,k) = NivAgua(i)
     end do
   end do
end do
!Asignamos valores a la segunda matriz(por mes)
i=1
   Do j=1,meses,1
	Do k = 1,datxmes,1
	Arraymes (j,k)=NivAgua(i)
	i=i+1
	End do
   End do
close (2)
print *, arraymes

!Datos Minimos por mes
open (6, file="MinimosMes.dat")
xMin=0 
do j = 1, meses, 1
     do k= 1,dxmes, 1
        if (Arraymes(j,k) .lt.  xMin) then
        xMin=Arraymes(j,k)
        end if
     Minmes(j)=xMin
     diamin(i)=(j-1)*dxmes+(k/48)+inicio
     end do
  Write (6,*) Minmes(j), diamin(i)
end do

!Datos Maximos por mes
 open (7, file="MaximosMes.dat")
xMax=-1
 do j = 1, meses, 1
     do k= 1, dxmes, 1
 if (Arraymes(j,k) .gt.  xMax) then
  xMax=Arraymes(j,k)
 end if
 Maxmes(j)=xMax
 Diamax(i)=(j-1)*dxmes+(k/48)+inicio
    end do
Write (7,*) Maxmes(j), diamax(i)
end do

!Datos Maximos por dia
 open (8, file="Maximos.dat")
do j = 1, dias, 1
    xMax = -1
    do k= 1, datos, 1
       if (Array(j,k) .gt.  xMax) then
       xMax=Array(j,k)
       end if
       Maxdia(j)=xMax
       horamax(j) = (j+inicio)+(k/48)
    end do
    Write (8,*) Maxdia(j), horamax (j)
end do


!Datos Minimos por dia
 open (9, file="Minimos.dat")
xMin=0 
do j = 1, dias, 1
     do k= 1, datos, 1
        if (Array(j,k) .lt.  xMin) then
        xMin=Array(j,k)
        end if
        Mindia(j)=xMin
        horamin(j) = (j+inicio)+(k/48)
     end do
     Write (9,*) Mindia(j), horamin(i)
end do

print *, 'nivel de marea maxima por dia', Maxdia, 'el dia', horamax
print *, 'nivel de marea minima por dia', Mindia, 'el dia', horamin 
print *, "---------------------------------------"
print *, 'nivel de marea minima por mes', MinMes, "el dia", diamin
print *, 'nivel de marea maxima por mes', MaxMes, "el dia", diamax
print * , '-----------------------------------------'

!Obtenemos los Periodos entre máximos mensuales

Do j=2,meses,1
Periodomax(j)=diamax(j)-diamax(j-1)
print * , 'Periodos entre maximos por mes', periodomax
end do

print * , '-----------------------------------------'
!Obtenemos los Periodos entre minimos mensuales

Do j=2,meses,1
Periodomin(j)=diamin(j)-diamin(j-1)
print * , 'Periodos entre maximos por mes', periodomin
end do
 
!Calculemos el minimo semidiurno
Open (10, file= "Minimosam")
Open (11, file="Maximosam")
do j = 1, semana, 1
xMin =0
xMax =-1
   do k = 1, datos, 1
      if (k .lt. 25) then
         if (Array(j,k) .lt. xMin) then
            xMin = Array(j,k) 
         end if         
      Minam(j)=xMin
      horaminam(j) = (j+inicio)+(k/48)
      Else
         if (Array (j,k) .gt. xMax) then
            xMax= Array (j,k)
         end if
      Maxam(j)=xMax
      horamaxam(j) = (j+inicio)+(k/48)
      end if
   end do
Write (10,*) horaminam(j),Minam(j)
Write (11,*) horamaxam(j), Maxam(j)
End do


End Program producto7
    
  

